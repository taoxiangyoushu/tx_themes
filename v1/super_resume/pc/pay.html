<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>超级简历 - 支付订单</title>
    <!-- Bootstrap -->
    <link rel="shortcut icon" href="../pc/assets/icon.ico" type="image/vnd.microsoft.icon" />
    <link rel="stylesheet" href="../pc/assets/css/bootstrap.min.css?v=cj0005">
    <link rel="stylesheet" href="../pc/assets/css/bootstrapValidator.min.css?v=cj0005">
    <link rel="stylesheet" href="../pc/assets/css/common.css?v=cj0005">
    <link rel="stylesheet" href="../pc/assets/css/pay/pay.css?v=cj0005">
	<!-- <link rel="stylesheet" href="../pc/assets/css/styles.css" /> -->
    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!--[if lt IE 9]>
      <script src="https://fastly.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
      <script src="https://fastly.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
	<script>
        var JANE_NAME = 'super_resume'
		var USER_TOKEN = 'RmlETkdPdjYzZmVjNTVhMDAyYzY='
        // var USER_TOKEN = 'bXlWWDZhMzY0NTlmYjFjYjgxZjU='
	</script>
</head>

<body>

<div class="haderNav navbarBox">
    <div class="container">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                            data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                        <span class="sr-only">切换导航</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="./index.html">
                        <img src="../pc/assets/img/cjjl_logo.png" alt="超级简历">
                    </a>
                </div>

                <div class="collapse navbar-collapse topNav" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li><a href="./index.html">首页</a></li>
                        <li><a href="./query.html">我的订单</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
</div>

<div class="container mainDiv">
    <div class="ContentMain">
        <div class="check-order">
            <a class="back_home" href="./index.html"> <span><</span> 返回首页</a>
            <div class="head">
                <img src="../pc/assets/img/checkorder_ico.png" alt="">
                <span class="label-t">订单详情</span>
                <span ></span>
            </div>
            <div class="order-info">
                <table class="orderInformation table" border="0" cellspacing="0">
                    <thead>
                        <tr>
                            <th width="340" class="order-text title"> 订单编号</th>
                            <th width="340" class="title">商品名称</th>
                            <th width="340">下单时间</th>
                            <th width="240" class="">应付金额</th>
                        </tr>
                    </thead>
                    <tbody class="tbody">
                        <td class="title order-oid"></td>
                        <td class="title order-name"></td>
                        <td class="order-time"></td>
                        <td class="price-t">￥ <span class="order-price"></span> </td>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="payBox">
            <div class="coupon-block">
                <div class="head">
                    <img src="../pc/assets/img/coupon_ico.png" alt="">
                    <span class="label-t">优惠券</span>
                </div>
                <div class="form-group form-group_s card">
                    <input autocomplete="off" class="form-control" onKeyUp="value=value.replace(/[\W]/g,'')" maxlength="30" name="coupon" type="text" placeholder="请输入优惠券码" id="coupon"/>
                    <div class="eliminateCoupon"></div>
                    <span class="use_now">兑换</span>
                    <span class="errorTip"><img src="../pc/assets/img/err_tip.png" alt=""><span></span></span>
                    <span class="activityTip"></span>
                </div>
            </div>
            <div class="pay-block">
                <div class="head">
                    <img src="../pc/assets/img/pay_ico.png" alt="">
                    <span class="label-t">支付方式</span>
                </div>
                <div class="clearfix2">
                    <div class="payType pull-left">
                        <div id="alipay" data-type="alipayScan" style="display: none;">
                            <img src="../pc/assets/img/zfb_logo.png" alt="">
                            <span>支付宝支付</span>
                        </div>
                        <div id="wx" data-type="wxScan" style="display: none;">
                            <img src="../pc/assets/img/wx_logo.png" alt="">
                            <span>微信支付</span>
                        </div>
                        <div id="scanCodeRich" data-type="scanCodeRich" style="display: none;">
                            <img src="../pc/assets/img/sm.png" alt="">
                            <span>扫码支付</span>
                        </div>
                        <div id="thirdparty" data-type="thirdparty" style="display: none;">
                            <img src="../pc/assets/img/dsf_ico.png" alt="">
                            <span>第三方支付</span>
                        </div>
                    </div>
                    <div class="code pull-left">
                        <div class="pull-left codeER">
                            <div id="qrcode"></div>
                            <div class="load">
                                <img src="../pc/assets/img/loading.gif" alt="">
                            </div>
                            <div class="mask">
                                <img src="../pc/assets/img/expired.png" alt="">
                                <p>点击刷新</p>
                            </div>
                            <p class="tips">提示：扫码支付,请勿刷新页面</p>
                        </div>
                        <div class="pull-left titlesRight payTypeClass">

                            <div class="amount">应付金额 <span><b>￥</b><span class="orderAmount">00.00</span></span></div>

                            <div class="pay-oid">订单号: <span class="order-oid order-copyText"></span> <span class="copy_oid">复制保存</span>  <input  id="copyInputPay" type="text"> </div>

                            <p class="auxiliary">剩余支付时间 <span class="time"><span class="payTime">--</span>秒</span>，<span class="next">已支付下一步</span></p>

                            <div class="tipsBox">
                                <div class="typeTips">
                                    <img class="scanCodeRichWx" src="../pc/assets/img/wx_logo.png" alt="">
                                    <img class="scanCodeRichAlipay" src="../pc/assets/img/zfb_logo.png" alt="">
                                    <!--                                    <img src="../assets/img/ysf.png" alt="">-->
                                    <span>使用<span class="scanCodeRichWxText"></span><span class="scanCodeRichAlipayText"></span>扫码支付 </span>
                                    <!--                                    <span>使用微信扫码支付 </span>-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tbPay pull-left">
                        <div class="Options">
                            <div id="XHS" class="zdyType" data-type="redBook">
                                <img src="../pc/assets/img/xhs_logo.png" alt="">
                                小红书订单
                            </div>
                            <div id="TB" class="zdyType" data-type="taobao">
                                <img src="../pc/assets/img/tb_logo.png" alt="">
                                淘宝订单
                            </div>
                        </div>

                        <div class="main">
                            <div class="tb-content">
                                <div class="tb-idBox">
                                    <label>订单编号：</label>
                                    <input
                                            autocomplete="off" maxlength="30" name="NumberWords"
                                            type="text"
                                            placeholder="填写淘宝订单编号(必填)"
                                            id="tbTid"
                                            class="form-control tb-oid noMarginTop" />

                                    <span class="tipsDiv2">
                                    <img src="../pc/assets/img/tipsText.png" alt="">
                                    <div>
                                        不满一件, 按一件计算
                                    </div>
                                </span>
                                </div>
                                <div class="tb-idBox">
                                    <label>备用订单：</label>
                                    <!-- onafterpaste="this.value=this.value.replace(/[^\d]/g,'') "
                                    onkeyup="this.value=this.value.replace(/[^\d]/g,'') "
                                     -->
                                    <input
                                            autocomplete="off" maxlength="60" name="NumberWords"
                                            type="text"
                                            placeholder="数额不足时填写，会合并数额"
                                            id="tbTid-2"
                                            class="form-control tb-oid" />
                                    <span class="tipsDiv">
                                        <img src="../pc/assets/img/tipsText2.png" alt="">
                                        <div>
                                            多个备用订单
                                            <br>
                                            请用英文逗号分隔
                                        </div>
                                    </span>
                                </div>
                                <div class="errTip"></div>
                                <div class="tb-payOrder">立即使用</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="mask_body"></div>
<div class="coupon_pop">
    <input  id="copyInput" type="text">
    <div class="pop_top">
        <div class="pop_title">支付提醒</div>
        <img class="close_pop" src="../pc/assets/img/delete2.png" alt="">
    </div>
    <div class="pop_cont">
        <p class="p1">是否使用免费券支付?</p>
        <div class="back_block">
            <p class="p2">订单编号: <span class="orderId_pop"></span> <span class="copy_pop">复制</span> </p>
            <p class="p3">订单编号是查询和下载报告的唯一标识，请妥善保存。</p>
        </div>
    </div>
    <div class="pop_bottom">
        <div class="cancel_btn">取消</div>
        <div class="determine_btn">确定</div>
    </div>
</div>
</body>
<script src="https://cdn.taoxiangyoushu.com/html/v1/utils/js/IeOutTips.js?code=11.0"></script>
<script src="../pc/assets/js/jquery.min.js?v=cj0005"></script>
<script src="https://cdn.taoxiangyoushu.com/tools/safari_handle.js?code=11.6"></script>
<script src="../pc/assets/js/bootstrap.min.js?v=cj0005"></script>
<script src="../pc/assets/js/bootstrapValidator.min.js?v=cj0005"></script>
<script src="../pc/assets/js/qrcode.min.js?v=cj0005"></script>
<script src="../pc/assets/js/coco-message.js?v=cj0005"></script>
<script src="../pc/assets/js/common.js?v=cj0005"></script>
<script src="../pc/assets/js/orderInfo.js?v=cj0005"></script>
<script>
    var qrcode = new QRCode(document.getElementById("qrcode"), {
        width: 135,
        height: 135,
    });
    var source = ''

    // 先判断是不是微信端打开的
    let client = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    if(client){
        source = 7
        if (/(micromessenger)/i.test(navigator.userAgent)) {
            source = 2
        }
    }else{
        source = 1
    }


    $(".order-oid").text(getQueryVariable('order_sn'))
    var pay_type = ''  //支付方式
    var typeAll = {
        wx: "wxScan",
        alipay: "alipayScan",
        scanCodeRich: "scanCodeRich",
        taobao: "taobao",
        redBook: 'redBook'
    }
    var noPayWay = false // 未配置支付
    var time = 600;
    var pay_id = '';
    var order_sn = '';
    var contentTypeIs = true;
    var timeout = null;
    var timeout2 = null;
    var Timeout = null;
    var isVerify = false;
    var pay_way_public = '';
    var closeMsg = cocoMessage.loading('正在获取价格...');
    var orderInfoData = {}

    if(getQueryVariable('order_sn')){
        order_sn = getQueryVariable('order_sn')
    }else{
        cocoMessage.error('订单丢失,请重新下单',2000);
        location.href = './index.html'
    }

    function tacitPay(goods_info, pay_way, scanCodeRichInfo) {
		$(".orderAmount2").text(goods_info.selling_price)
    	$(".originalPrice2").text(returnFloat((Number(goods_info.selling_price)+100)))
        pay_way_public = pay_way
        pay_type = typeAll[pay_way.default]
        if(!pay_way.alipay && !pay_way.wx && !pay_way.scanCodeRich && !pay_way.taobao && !pay_way.redBook){
            noPayWay = true
        }
        if(pay_type == 'scanCodeRich') { // 扫码付
            if(scanCodeRichInfo.scanCodeRichWx.enabled) {
                $('.tipsBox .scanCodeRichWx').show()
                $('.scanCodeRichWxText').text('微信')
                if(!scanCodeRichInfo.scanCodeRichAlipay.enabled && pay_way.alipay) {
                    $('#alipay').show()
                    $('#scanCodeRich').show()
                    $('#scanCodeRich').addClass('select')
                }
            }
            if(scanCodeRichInfo.scanCodeRichAlipay.enabled) {
                $('.tipsBox .scanCodeRichAlipay').show()
                $('.scanCodeRichAlipayText').text('支付宝')
                if(!scanCodeRichInfo.scanCodeRichWx.enabled && pay_way.wx) {
                    $('#wx').show()
                    $('#scanCodeRich').show()
                    $('#scanCodeRich').addClass('select')
                }
            }
            if(scanCodeRichInfo.scanCodeRichWx.enabled && scanCodeRichInfo.scanCodeRichAlipay.enabled){
                $('.scanCodeRichWxText').text('微信、')
            }
            $('.tipsBox').show()
            $(".code").show();
            $('.titlesRight').addClass('payTypeClass')
            if(pay_way.taobao || pay_way.redBook) {// 扫码付有自定义订单的时候, 出现选项
                $('#thirdparty').show()
                $('#scanCodeRich').show()
                $('#scanCodeRich').addClass('select')
            }
        }else{
            if(pay_way.alipay) $('#alipay').show()
            if(pay_way.wx) $('#wx').show()
            $('.clearfix2>.payType>div').removeClass('select')
            $('#' + pay_way.default).addClass('select')
            if(pay_way.taobao || pay_way.redBook) { // 第三方订单展示控制
                if(pay_type != 'taobao' && pay_type!='redBook') $('#thirdparty').show()

                if(pay_way.taobao) {
                    $('#TB').show()
                }
                if(pay_way.redBook) {
                    $('#XHS').show()
                }
            }
            // 默认支付方式为淘宝或小红书的时候, 说明没有其他支付方式了
            if(pay_type == 'taobao' || pay_type=='redBook') { // 淘宝或小红书订单(第三方订单)
                $(".code").hide();
                $(".tbPay").show();
                $(".tbPay").css('paddingLeft', 0)

                if(pay_type == 'taobao') { // 默认选中第三方支付方式
                    $('#TB').addClass('Select')
                }else {
                    $('#XHS').addClass('Select')
                }
                placeholder()
            }else {
                $(".code").show();
            }
        }

        if(noPayWay){
            closeMsg()
        }else{
            if(pay_type == 'thirdparty'){
                closeMsg()
                return
            }
            payOrder(pay_type)
        }
    }

    function payOrder(payType,price) {
        $('.load').show()
        $(".mask").hide();
        if(pay_type == 'taobao' || pay_type == 'redBook') {
            $('.load').hide()
            closeMsg()
            // pay_id = order_sn
            contentTypeIs = true
            return;
        }
        if(pay_type == 'scanCodeRich'){
            if(orderInfoData.pay_wap_url) {
                $(".code").show()
                $(".orderAmount").text(price?price:orderInfoData.order_amount)
                
                qrcode.makeCode(orderInfoData.pay_wap_url + '/pay/waporder/' + (order_sn?order_sn:getQueryVariable('order_sn')) + '?source=' + source);
                $('.load').hide()
                time = 600
                $('.payTime').text(time)
                $('.order-oid').text(order_sn?order_sn:getQueryVariable('order_sn'))
                if(!order_sn){
                    order_sn = getQueryVariable('order_sn')
                }
                contentTypeIs = true
                closeMsg()
                payStatus()
                countdown()
            }else {
                // 避免订单信息接口太慢, 导致pay_wap_url拿不到
                setTimeout(function() {
                    payOrder(payType,price)
                }, 1000)
            }
        }else{
            var formData = getFormData({
                order_sn: order_sn || getQueryVariable('order_sn'),
                pay_type,
                source
            })
            $.ajax({
                type: 'post',
                url: urls + '/api/client/pay/payOrder',
                processData: false,
                contentType: false,
                xhrFields: {
                    withCredentials: true
                },
                data: formData,
                success: function(data) {
                    if(data.code == 200) {
                        qrcode.makeCode(data.data.qrlink);
                        $('.orderAmount').text(data.data.payment_money || '-.--')
                        $('.load').hide()
                        time = 600
                        $('.payTime').text(time)
                        pay_id = data.data.pay_id
                        payStatus()
                        countdown()
                    }else if(data.code == 3001) {
                        cocoMessage.success('订单已支付', 2000)
                        window.location.href = "./query.html?oid=" + order_sn;
                    }else if(data.code == -1 && data.codeMsg == '不支持的该支付方式'){
                        cocoMessage.error(data.codeMsg, 2000);
                    }else {
                        cocoMessage.error(data.codeMsg, 2000);
                        $(".mask").show()
                        $('.load').hide()
                    }
                    contentTypeIs = true
                    closeMsg()
                },
                error: function(err) {
                    cocoMessage.error("请求失败!请检查网络", 2000);
                    contentTypeIs = true
                    closeMsg()
                }
            });
        }
    }

    // 支付方式切换
    $('.clearfix2>.payType>div').click(function () {
        if(pay_type) {
            if(!contentTypeIs) return
            if($(this).attr('data-type') != pay_type) {
                closeMsg = cocoMessage.loading('正在切换支付方式...');
                contentTypeIs = false
                $('.clearfix2>.payType>div').removeClass('select')
                if($(this).attr('data-type') == 'scanCodeRich'){
                    $('.titlesRight').removeClass('payTypeClass')
                    $(".tipsBox").show()
                }else{
                    $('.titlesRight').addClass('payTypeClass')
                    $(".tipsBox").hide()
                }
                $(this).addClass('select')
                pay_type = $(this).attr('data-type')
                if(pay_type == 'thirdparty'){
                    thirdpartyPayOrder()
                    return;
                }
                $(".tbPay").hide();
                $(".code").show();
                payOrder()
            }
        }
    })

    // 切换自定义订单提示
    function placeholder() {
        if($('.zdyType.Select').attr('id')=='XHS') {
            $('#tbTid').attr('placeholder' , '填写小红书订单编号(必填)')
        }else {
            $('#tbTid').attr('placeholder' , '填写淘宝订单编号(必填)')
        }
    }

    // 切换到第三方支付
    function thirdpartyPayOrder() {
        $(".code.pull-left").hide();
        contentTypeIs = true;
        $(".tbPay").show();

        if(pay_way_public.taobao) $('#TB').show()
        if(pay_way_public.redBook) $('#XHS').show()

        // 默认选中第三方支付方式
        if(pay_way_public.redBook) {
            $('#XHS').addClass('Select')
        }else {
            $('#TB').addClass('Select')
        }

        placeholder()
        clearTimeout(Timeout)
        time = 0
        closeMsg();
    }

    // 切换第三方支付方式
    $('.zdyType').click(function() {
        $('.zdyType').removeClass('Select')
        $(this).addClass('Select')
        placeholder()
        $(".errTip").text('')
    })

    // 第三方支付,确认按钮
    var TbPaying = false
    $(".tb-payOrder").click(function (){
        $(".errTip").hide();
        $(".tbPay").removeClass('errInput')
        if(TbPaying){
            return;
        }
        if(!$("#tbTid").val()) {
            $(".errTip").text($('#tbTid').attr('placeholder'))
            $(".tbPay").addClass('errInput')
            $(".errTip").show();
            return
        }
        var closeMsgTb = cocoMessage.loading("订单支付中", 2000);
        let formData = getFormData({
            order_sn: order_sn || getQueryVariable('order_sn'),
            pay_type: $('.zdyType.Select').attr('data-type'),
            tids: $("#tbTid").val() + ($('#tbTid-2').val()?(','+$('#tbTid-2').val()):''),
            source
        })
        TbPaying = true
        $.ajax({
            type: 'post',
            url: urls + '/api/client/pay/payOrder',
            processData: false,
            contentType: false,
            xhrFields: {
                withCredentials: true
            },
            data: formData,
            success: function (data) {
                TbPaying = false
                if(data.code == 200){

                }else{
                    if(data.code == 3001){
                        cocoMessage.success('订单已支付', 2000)
                        window.location.href = window.location.origin + "/query_order?oid=" + order_sn;
                        return
                    }
                    $(".tbPay").addClass('errInput')
                    $(".errTip").text(data.codeMsg)
                    $(".errTip").show();
                }
            },
            error: function (err) {
                TbPaying = false
                cocoMessage.error("请求失败!请检查网络", 2000);
                contentTypeIs = true
            },
            complete: function (){
                closeMsgTb()
            }
        })
    })

    // 支付倒计时
    function countdown(){
        clearTimeout(timeout2)
        timeout2 = setTimeout(function (){
            time --
            $('.payTime').text(time>0? time : 0)
            if(time > 0){
                countdown()
            }
        },1000)
    }

    // 订单轮询
    function payStatus() { // 轮询
        clearTimeout(Timeout);
        $.ajax({
            type: 'get',
            url: urls + '/apirs/order/is_pay?pay_id=' + order_sn,
            xhrFields: {
                withCredentials: true
            },
            success: function (res) {
                clearTimeout(Timeout);
                if (time <= 0) {
                    $(".mask").show();
                }
                if (!res.data) {
                    if (time > 0) {
                        Timeout = setTimeout(function () {
                            payStatus();
                        }, 1000);
                    }
                }else {
                    clearTimeout(Timeout);
                    window.location.href = "./query.html?oid=" + order_sn;
                }
            },
            error: function () {
                cocoMessage.error("请求失败!请检查网络", 2000);
                clearTimeout(Timeout);
                Timeout = setTimeout(function () {
                    payStatus();
                }, 3000);
            },
        });
    }

    // 刷新支付二维码
    $('.code .mask').click(function() { // 点击刷新
        $(".mask").hide();
        $('.load').show();
        payOrder()
    })

    // 下一步
    $('.next').click(function() {
        if(isVerify) return
        isVerify = true
        setTimeout(() => {
            isVerify = false
        },3000)
        var form_data = getFormData({
            pay_id: order_sn
        })
        $.ajax({
            type: 'post',
            url: urls + '/api/client/pay/verifyOrder',
            processData: false,
            contentType: false,
            xhrFields: {
                withCredentials: true
            },
            data: form_data,
            success: function (res) {
                if (res.code == 3001) {
                    cocoMessage.destroyAll();
                    cocoMessage.success('订单已支付', 2000)
                    window.location.href = "./query.html?oid=" + order_sn;
                }else {
                    cocoMessage.destroyAll();
                    cocoMessage.error("您的订单未支付", 2000);
                }
            },
            error: function () {
                cocoMessage.error("请求失败!请检查网络", 2000);
            },
            complete: function () {
                isVerify = false
            }
        });
    })

    //优惠券
    $("#coupon").on('input',function (){
        if($(this).val().length > 0){
            $(".use_now").addClass('can')
        }else{
            $(".use_now").removeClass('can')
        }
    })

    $("#coupon").on('change',function (){
        $(".errorTip").hide();
    })

    let canClick = true;
    $(".use_now").on('click',function() {
        if(!canClick){
            return
        }
        canClick = false
        closeMsg = cocoMessage.loading('正在兑换优惠券...');

        var formData = getFormData({
            order_sn: order_sn || getQueryVariable('order_sn'),
            code: $("#coupon").val()
        })

        $.ajax({
            type: 'post',
            url: urls + '/api/client/order/variation/order',
            data: formData,
            contentType: false,
            processData: false,
            xhrFields: {
                withCredentials: true
            },
            success: function (res) {
                canClick = true
                closeMsg()
                if (res.code == 200) {
                    order_sn = res.data.order_sn
                    $('.orderId_pop').text(res.data.order_sn)
                    $('.order-oid').text(res.data.order_sn)
                    if(Number(res.data.order_amount) == 0) {
                        $(".coupon_pop").show();
                        $(".mask_body").show();
                    }else{
                        if(noPayWay){
                            cocoMessage.error("此优惠券不满足免单条件！", 2000);
                            return;
                        }
                        payOrder('',res.data.order_amount)
                    }
                }else {
                    $(".errorTip span").text(res.codeMsg)
                    $(".errorTip").show();
                    closeMsg()
                    cocoMessage.error(res.codeMsg, 2000);
                }
            },
            error: function () {
                cocoMessage.error("请求失败!请检查网络", 2000);
                contentTypeIs = true
                closeMsg()
                canClick = true
            },
        });

    })

    $(".copy_oid").on('click', function (){
        var text = $(".order-copyText").text()
        $("#copyInputPay").val(text)
        $("#copyInputPay").select()
        try {
            var state = document.execCommand("copy");
        } catch (err) {
            var state = false;
        }
        if (state) {
            cocoMessage.success(1000, "复制成功", function() {
            });
        } else {
            cocoMessage.error(1000, "复制失败", function () {
            });
        }
    })

    $(".copy_pop").on('click',function (){
        var text = $(".orderId_pop").text()
        $("#copyInput").val(text)
        $("#copyInput").select()
        try {
            var state = document.execCommand("copy");
        } catch (err) {
            var state = false;
        }
        if (state) {
            cocoMessage.success(1000, "复制成功", function() {
            });
        } else {
            cocoMessage.error(1000, "复制失败", function() {
            });
        }
    })

    function couponsPay() {
        var formData2 = getFormData({
            order_sn: order_sn,
            pay_type: 'coupons',
            source
        })
        $.ajax({
            type: 'post',
            url: urls + '/api/client/pay/payOrder',
            data: formData2,
            contentType: false,
            processData: false,
            xhrFields: {
                withCredentials: true
            },
            success: function (res) {
                if (res.code == 200) {

                }else if(res.code == 3001) {
                    cocoMessage.success('订单已支付', 2000)
                    window.location.href = "./query.html?oid=" + order_sn;
                }else {
                    cocoMessage.error(res.codeMsg, 2000);
                    closeMsg()
                }
            },
            error: function () {
                cocoMessage.error("请求失败!请检查网络", 2000);
                contentTypeIs = true
                closeMsg()
            },
        });
    }

    $(".close_pop").on('click',function (){
        $(".coupon_pop").hide();
        $(".mask_body").hide();
    })
    $(".cancel_btn").on('click',function (){
        $(".coupon_pop").hide();
        $(".mask_body").hide();
    })
    $(".determine_btn").on('click',function (){
        couponsPay()
    })


    $('.getBack').click(function() {
        location.href = './index.html'
    })
    function returnFloat(value){
        var value=Math.round(parseFloat(value)*100)/100;
        var xsd=value.toString().split(".");
        if(xsd.length==1){
            value=value.toString()+".00";
            return value;
        }
        if(xsd.length>1){
            if(xsd[1].length<2){
                value=value.toString()+"0";
            }
            return value;
        }
    }
</script>
</html>